#include <avr/interrupt.h>
#include <avr/io.h>
#include <stdint.h>
#include <string.h>
#include <util/delay.h>

#include "button.h"
#include "hal.h"
#include "i2c.h"
#include "main.h"
#include "ssd1306.h"

int main(void) {

  /* Set onboard LED as output */

  set_pin(LED_DDR, LED_PIN);
  reset_pin(LED_PORT, LED_PIN);

  /* Init the 2-wire interface */

  i2c_init(4, 4);

  /* Configure the button */

  button_init();

  /* Activate the interrupts */

  sei();

  uint8_t data[] = {
    0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F, 0x0F,
    0x3F, 0x3F, 0x3F, 0x3F, 0x3C, 0x3C, 0x3C, 0x3C, 0x3C, 0x3C, 0x3C, 0x3C, 0x3C, 0x3C, 0x3C, 0x3C,
  };
  uint8_t cmd2[] = { 0x21, 10, 25, 0x22, 0, 3 };

  ssd1306_clear_screen();

  // ssd1306_goto(0, 0);
  ssd1306_cmd(cmd2, sizeof(cmd2));
  ssd1306_data(data, sizeof(data));


  while (1) {

    /* Send the data vector to test the driver */

    toggle_pin(LED_PORT, LED_PIN);

    _delay_ms(500);

  }
}
